# Reference TypeScript Pack
#
# This is the OFFICIAL reference implementation for Scaffoldix pack authors.
# It demonstrates the golden path for creating packs and is used for:
# - Integration tests
# - Documentation examples
# - Developer onboarding
#
# Treat this pack as the canonical example of best practices.

pack:
  name: reference-typescript
  version: "0.1.0"

scaffoldix:
  compatibility:
    minVersion: "0.1.0"

archetypes:
  # =========================================================================
  # Archetype 1: Base Project
  # =========================================================================
  # Generates a minimal but complete TypeScript project from scratch.
  # Demonstrates: inputs, templates, filename rules, conditional rendering.
  #
  - id: base-project
    templateRoot: templates/base-project

    inputs:
      - name: projectName
        type: string
        required: true
        prompt: "What is your project name?"

      - name: packageName
        type: string
        required: true
        prompt: "What is your npm package name?"

      - name: useStrict
        type: boolean
        default: true
        prompt: "Enable strict TypeScript mode?"

      - name: includeTests
        type: boolean
        default: true
        prompt: "Include test setup (vitest)?"

    # Format the generated code
    postGenerate:
      - npm install

    # Verify the generated project compiles
    checks:
      - npx tsc --noEmit

  # =========================================================================
  # Archetype 2: Module
  # =========================================================================
  # Generates a new module inside an existing project.
  # Demonstrates: incremental generation, marker-based patching, idempotency.
  #
  # IMPORTANT: This archetype expects an existing project generated by
  # base-project. It patches src/index.ts to export the new module.
  #
  - id: module
    templateRoot: templates/module

    inputs:
      - name: moduleName
        type: string
        required: true
        prompt: "What is the module name (camelCase)?"

      - name: moduleDescription
        type: string
        default: "A new module"
        prompt: "Brief description of this module?"

    patches:
      # Insert export statement into src/index.ts
      - kind: marker_insert
        file: src/index.ts
        idempotencyKey: "export-module-{{moduleName}}"
        markerStart: "// <scaffoldix:exports>"
        markerEnd: "// </scaffoldix:exports>"
        description: "Export the new module from index.ts"
        contentTemplate: |
          export * from "./{{moduleName}}";

    # Verify the project still compiles after adding the module
    checks:
      - npx tsc --noEmit
